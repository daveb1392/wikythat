# Railway Deployment Checklist

Use this checklist to ensure smooth deployment to Railway.

## Pre-Deployment

### Database Setup
- [ ] Supabase account created
- [ ] All 3 migrations run in Supabase SQL Editor:
  - [ ] `001_initial_schema.sql`
  - [ ] `002_add_trust_votes.sql`
  - [ ] `003_add_grokipedia_slugs.sql`
- [ ] Grokipedia slugs synced (`npm run sync-slugs`)
- [ ] Verify: `SELECT COUNT(*) FROM grokipedia_slugs;` returns ~6M+

### API Keys Ready
- [ ] Supabase URL and anon key copied
- [ ] xAI API key obtained from https://x.ai/api
- [ ] (Optional) Upstash Redis URL and token

### Code Prepared
- [ ] All code committed to Git
- [ ] Pushed to GitHub
- [ ] `.env.local` NOT committed (in `.gitignore`)
- [ ] `.env.example` exists for documentation

## Railway Setup

### Create Project
- [ ] Railway account created/logged in
- [ ] New project created from GitHub repo
- [ ] Repository connected successfully

### Backend Service (Python API)
Deploy the Python backend separately:

- [ ] Create new Railway service from `backend/` directory
- [ ] Configure Python buildpack (detected automatically)
- [ ] Set start command: `uvicorn main:app --host 0.0.0.0 --port $PORT`
- [ ] Backend environment variables:
  - [ ] `ANALYTICS_KEY` (optional)
  - [ ] `HEALTH_SECRET` (required)
- [ ] Note the Railway-generated URL (e.g., `https://backend-xxx.railway.app`)

### Frontend Service Environment Variables
Add these in Railway Dashboard → Variables:

- [ ] `NEXT_PUBLIC_SUPABASE_URL`
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `XAI_API_KEY`
- [ ] `GROKIPEDIA_API_URL` (Backend Railway URL from above)
- [ ] `NEXT_PUBLIC_SITE_URL` (will update after domain generated)
- [ ] (Optional) `UPSTASH_REDIS_REST_URL`
- [ ] (Optional) `UPSTASH_REDIS_REST_TOKEN`
- [ ] (Optional) `NEXT_PUBLIC_GA_ID`
- [ ] (Optional) `DATAFORSEO_API_AUTH`

### Domain Configuration
- [ ] Railway domain generated (Settings → Networking)
- [ ] `NEXT_PUBLIC_SITE_URL` updated with Railway domain
- [ ] (Optional) Custom domain added
- [ ] (Optional) DNS configured for custom domain

## Testing

### Basic Functionality
- [ ] Homepage loads without errors
- [ ] Search autocomplete works
- [ ] Type "bill" → shows "Bill Clinton" in results
- [ ] Type "hillary" → does NOT show "Hillary Clinton" (missing on Grokipedia)
- [ ] Click suggestion → navigates to comparison page

### Comparison Page
- [ ] Wikipedia panel shows article + image
- [ ] Grokipedia panel shows article + shared image
- [ ] Grok analysis loads after ~15 seconds
- [ ] Analysis is formatted correctly (headings, bold text, sections)
- [ ] Trust counter displays
- [ ] Vote buttons work

### Rate Limiting
- [ ] Make 11 quick requests → 11th returns 429 error
- [ ] Check Railway logs for rate limit messages

### Error Handling
- [ ] Search for non-existent topic → shows appropriate message
- [ ] Missing Grokipedia article → shows "Not covered yet" message
- [ ] No console errors in browser dev tools

## Post-Deployment

### Monitoring Setup
- [ ] Railway logs reviewed (no critical errors)
- [ ] Supabase dashboard checked (queries executing)
- [ ] Test 5-10 different topic searches
- [ ] Share with friends for user testing

### GitHub Actions
- [ ] GitHub secrets added:
  - [ ] `NEXT_PUBLIC_SUPABASE_URL`
  - [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] Workflow manually triggered to test
- [ ] Workflow scheduled for weekly runs

### Documentation
- [ ] Update repository README with live URL
- [ ] Add screenshot/demo to README
- [ ] Document any deployment issues encountered

## Optional Enhancements

### Custom Domain
- [ ] Domain purchased
- [ ] DNS CNAME configured
- [ ] SSL certificate auto-generated by Railway
- [ ] `NEXT_PUBLIC_SITE_URL` updated

### Analytics
- [ ] Google Analytics set up
- [ ] `NEXT_PUBLIC_GA_ID` added to Railway
- [ ] Verify tracking works

### Upstash Redis
- [ ] Upstash account created
- [ ] Redis database created
- [ ] Credentials added to Railway
- [ ] Distributed rate limiting verified

## Troubleshooting

If deployment fails, check:

1. **Build errors:**
   - [ ] All dependencies in `package.json`
   - [ ] No TypeScript errors locally
   - [ ] Railway build logs for specific errors

2. **Runtime errors:**
   - [ ] All environment variables set correctly
   - [ ] Supabase credentials valid
   - [ ] xAI API key has credits

3. **Database issues:**
   - [ ] Migrations ran successfully
   - [ ] Slug sync completed
   - [ ] Supabase not over free tier limits

## Success Criteria

✅ Site loads on Railway domain
✅ Search shows only valid comparisons
✅ Grok analysis generates successfully
✅ Rate limiting works
✅ No errors in Railway logs
✅ GitHub Actions workflow runs successfully

---

**Estimated Time:** 10-15 minutes (excluding slug sync)

**First Deploy?** Follow [RAILWAY_DEPLOYMENT.md](./RAILWAY_DEPLOYMENT.md) for detailed instructions.
